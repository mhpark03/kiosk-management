commands:
  01_install_ffmpeg:
    command: |
      # Check if FFmpeg is already installed
      if ! command -v ffmpeg &> /dev/null; then
        echo "Installing FFmpeg..."

        # Try installing via dnf (Amazon Linux 2023)
        if command -v dnf &> /dev/null; then
          echo "Using dnf package manager..."
          dnf install -y ffmpeg || echo "dnf install failed, trying alternative method"
        fi

        # If dnf didn't work, try yum (Amazon Linux 2)
        if ! command -v ffmpeg &> /dev/null && command -v yum &> /dev/null; then
          echo "Using yum package manager..."
          amazon-linux-extras enable epel -y || true
          yum install -y epel-release || true
          yum install -y ffmpeg || echo "yum install failed"
        fi

        # Verify installation
        if command -v ffmpeg &> /dev/null; then
          echo "FFmpeg installation completed"
          ffmpeg -version
        else
          echo "FFmpeg installation failed - video merge feature will not work"
        fi
      else
        echo "FFmpeg is already installed at $(which ffmpeg)"
        ffmpeg -version
      fi
    ignoreErrors: true
