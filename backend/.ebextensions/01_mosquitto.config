packages:
  yum:
    mosquitto: []

files:
  "/etc/mosquitto/conf.d/default.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      listener 1883 0.0.0.0
      allow_anonymous true
      max_connections 1000

      # Logging
      log_dest file /var/log/mosquitto/mosquitto.log
      log_type all
      connection_messages true
      log_timestamp true

  "/tmp/setup_mosquitto.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      # Create log directory
      mkdir -p /var/log/mosquitto
      chown mosquitto:mosquitto /var/log/mosquitto

      # Restart mosquitto service
      systemctl restart mosquitto
      systemctl enable mosquitto

      # Check status
      systemctl status mosquitto

commands:
  01_setup_mosquitto:
    command: "/tmp/setup_mosquitto.sh"
    ignoreErrors: false
